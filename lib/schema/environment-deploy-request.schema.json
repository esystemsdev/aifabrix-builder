{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/esystemsdev/aifabrix-builder/refs/heads/main/lib/schema/environment-deploy-request.schema.json",
  "title": "Environment Deploy Request",
  "description": "Request body for POST /api/v1/environments/{envKey}/deploy",
  "type": "object",
  "required": ["environmentConfig"],
  "properties": {
    "environmentConfig": {
      "type": "object",
      "description": "Environment infrastructure configuration",
      "required": ["key", "environment", "preset", "serviceName", "location"],
      "properties": {
        "key": {
          "type": "string",
          "description": "Environment key",
          "pattern": "^[a-z0-9-]+$",
          "minLength": 2,
          "maxLength": 40
        },
        "environment": {
          "type": "string",
          "description": "Environment type",
          "enum": ["miso", "dev", "tst", "pro"]
        },
        "preset": {
          "type": "string",
          "description": "Deployment preset size",
          "enum": ["evaluation", "eval", "s", "m", "l", "xl"]
        },
        "serviceName": {
          "type": "string",
          "description": "Service name for resource naming",
          "pattern": "^[a-z0-9-]{2,40}$"
        },
        "location": {
          "type": "string",
          "description": "Azure region (e.g. swedencentral)"
        },
        "resourceGroupName": { "type": "string" },
        "subscriptionId": { "type": "string" },
        "tenantId": { "type": "string" },
        "customDomain": { "type": "object" },
        "frontDoor": { "type": "object" },
        "networking": { "type": "object" },
        "allowedIPs": {
          "type": "array",
          "items": { "type": "string" }
        },
        "infrastructureAccess": {
          "type": "array",
          "items": { "type": "object" }
        }
      },
      "additionalProperties": true
    },
    "dryRun": {
      "type": "boolean",
      "description": "If true, validate only without deploying",
      "default": false
    }
  },
  "additionalProperties": false
}
