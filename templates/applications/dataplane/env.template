# Environment Variables Template
# Use kv:// references for secrets (resolved from .aifabrix/secrets.yaml)
# Use ${VAR} for environment-specific values

# =============================================================================
# APPLICATION ENVIRONMENT
# =============================================================================

# HTTP port for the app
PORT=3001
# development | staging | production
ENVIRONMENT=development
# Enable debug mode
DEBUG=false
# Logging level: DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_LEVEL=INFO
# Log format: json or text
LOG_FORMAT=json
# Path for log file output
LOG_FILE_PATH=/mnt/data/logs/app.log
# If true, run without Redis/Celery (single process)
LOCAL_MODE=false

# When API_KEY is set, a matching Bearer token bypasses OAuth2 validation
API_KEY=kv://miso-controller-api-key-secretKeyVault

# API Configuration
API_V1_STR=/api/v1
VERSION=1.7.0
# Base URL for the dataplane web server (used for default OAuth2 callback URL when redirectUri is omitted)
DATAPLANE_WEB_SERVER_URL=kv://dataplane-web-server-urlKeyVault
DATAPLANE_INTERNAL_URL=kv://dataplane-internal-server-urlKeyVault

# CORS Configuration
ALLOWED_ORIGINS=http://localhost:*
IDE_CORS_ORIGINS=

# Encryption Configuration
ENCRYPTION_KEY=kv://secrets-encryptionKeyVault

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# Primary app database URL
DATABASE_URL=kv://databases-dataplane-0-urlKeyVault
DB_0_PASSWORD=kv://databases-dataplane-0-passwordKeyVault

# Vector and document store DB: chunks, embeddings, vector indexes (pgvector).
# Binaries path: config.processing.fileStoragePath or /data/documents.
VECTOR_DATABASE_URL=kv://databases-dataplane-1-urlKeyVault
DB_1_PASSWORD=kv://databases-dataplane-1-passwordKeyVault

# Logs Database Configuration (for execution, audit, ABAC traces)
LOGS_DATABASE_URL=kv://databases-dataplane-2-urlKeyVault
DB_2_PASSWORD=kv://databases-dataplane-2-passwordKeyVault

# Records Database Configuration (for external records storage)
RECORDS_DATABASE_URL=kv://databases-dataplane-3-urlKeyVault
DB_3_PASSWORD=kv://databases-dataplane-3-passwordKeyVault

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================
# Connects to external redis from aifabrix-setup

REDIS_URL=kv://redis-url

# =============================================================================
# CACHE CONFIGURATION
# =============================================================================

# Enable in-memory cache
CACHE_ENABLED=true
# TTL in seconds for CIP execution cache
CACHE_CIP_EXECUTION_TTL=1800
# TTL in seconds for metadata filter cache
CACHE_METADATA_FILTER_TTL=3600

# =============================================================================
# AUTHENTICATION CONFIGURATION
# =============================================================================

# MISO Application Client Credentials (per application)
MISO_CLIENTID=kv://dataplane-client-idKeyVault
MISO_CLIENTSECRET=kv://dataplane-client-secretKeyVault

# Keycloak Configuration (for OAuth2 endpoints)
# Public: used by OpenAPI OAuth2 / browser (authorizationUrl, tokenUrl).
KEYCLOAK_SERVER_URL=kv://keycloak-server-urlKeyVault
# Internal (same role as MISO_CONTROLLER_URL): future server-side Keycloak (e.g. JWKS). Not used by dataplane today.
KEYCLOAK_INTERNAL_SERVER_URL=kv://keycloak-internal-server-urlKeyVault
KEYCLOAK_REALM=aifabrix

# =============================================================================
# MISO CONTROLLER CONFIGURATION
# =============================================================================
# Public: browser redirects and CORS for client_token; set when controller is behind a different public URL.
MISO_WEB_SERVER_URL=kv://miso-controller-web-server-urlKeyVault
# Internal: server-to-controller API calls (auth, pipeline, status, RBAC).
MISO_CONTROLLER_URL=http://${MISO_HOST}:${MISO_PORT}

# Pipeline env key for controller URLs: /api/v1/pipeline/{envKey}/validate and /deploy.
# Set MISO_PIPELINE_ENV_KEY=dev when controller uses dev (e.g. MISO_CLIENTID=miso-controller-dev-dataplane).
# If unset, derived from MISO_CLIENTID (e.g. dev from miso-controller-dev-dataplane).
MISO_PIPELINE_ENV_KEY=

# =============================================================================
# AI/LLM CONFIGURATION
# =============================================================================

# OpenAI Configuration
OPENAI_API_KEY=kv://secrets-openaiApiKeyVault

# Azure OpenAI Configuration
AZURE_OPENAI_ENDPOINT=
AZURE_OPENAI_API_KEY=kv://secrets-azureOpenaiApiKeyVault
AZURE_OPENAI_API_VERSION=2024-02-15-preview
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-4o

# =============================================================================
# AUDIT CONFIGURATION
# =============================================================================

# General Audit Settings
AUDIT_ENABLED=true
MISO_LOG_FORWARD_ERRORS=true
AUTH_AUDIT_ENABLED=true

# ABAC Audit Configuration
ABAC_AUDIT_ENABLED=true
# ABAC audit detail: summary | detailed
ABAC_AUDIT_DETAIL_LEVEL=summary
ABAC_EXPLAIN_MODE_ENABLED=false
ABAC_PERFORMANCE_THRESHOLD_MS=1000

# RBAC Audit Configuration
RBAC_AUDIT_ENABLED=true
# RBAC audit detail: summary | detailed | explain
RBAC_AUDIT_DETAIL_LEVEL=summary
RBAC_EXPLAIN_MODE_ENABLED=false

# =============================================================================
# OBSERVABILITY CONFIGURATION
# =============================================================================

# OpenTelemetry Configuration
OPENTELEMETRY_ENABLED=false
OPENTELEMETRY_ENDPOINT=

# =============================================================================
# CIP EXECUTION CONFIGURATION
# =============================================================================
# These control CIP (Composable Integration Pipeline) execution behavior

CIP_EXECUTION_MAX_RESPONSE_SIZE_MB=100.0
CIP_EXECUTION_MAX_RECORDS=100000
CIP_EXECUTION_OPERATION_TIMEOUT=300.0
CIP_EXECUTION_HTTP_TIMEOUT=30.0
CIP_EXECUTION_MAX_RETRIES=3
CIP_EXECUTION_RETRY_BACKOFF_FACTOR=2.0
CIP_EXECUTION_RETRY_INITIAL_DELAY=1.0

# Circuit Breaker Configuration
CIP_EXECUTION_CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIP_EXECUTION_CIRCUIT_BREAKER_TIME_WINDOW=60
CIP_EXECUTION_CIRCUIT_BREAKER_SUCCESS_THRESHOLD=2
CIP_EXECUTION_CIRCUIT_BREAKER_HALF_OPEN_TIMEOUT=30

# Rate Limiting Configuration
CIP_EXECUTION_RATE_LIMIT_REQUESTS_PER_SECOND=10.0
CIP_EXECUTION_RATE_LIMIT_BURST_SIZE=20
