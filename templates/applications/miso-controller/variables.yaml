# Application Metadata
app:
  key: miso
  displayName: "Miso Controller"
  description: "AI Fabrix Miso Controller - Backend API and orchestration service"
  type: webapp

# Image Configuration
image:
  name: aifabrix/miso-controller
  registry: devflowiseacr.azurecr.io
  registryMode: acr

# Port Configuration
port: 3000

# Azure Requirements
requires:
  database: true
  databases:
    - name: miso
    - name: miso-logs
  redis: true
  storage: true

# Health Check
healthCheck:
  path: /health
  interval: 30
  probePath: /health
  probeRequestType: GET
  probeProtocol: Https
  probeIntervalInSeconds: 120

# Authentication
authentication:
  type: keycloak
  enableSSO: true
  requiredRoles: ["aifabrix-user"]
  endpoints:
    local: "http://localhost:3000/auth/callback"

# Build Configuration
build:
  context: ..                                           # Docker build context (relative to builder/)
  dockerfile: builder/Dockerfile                        # Dockerfile name (empty = use template)
  envOutputPath: ../packages/miso-controller/.env       # Copy .env to repo root for local dev
  localPort: 3010                                       # Port for local development (different from Docker port)
  language: typescript                                  # Runtime language for template selection
  secrets: "../../secrets.local.yaml"                   # Path to secrets file (optional)

# Docker Compose
compose:
  file: docker-compose.yaml
  service: miso-controller

